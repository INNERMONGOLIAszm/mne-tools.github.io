<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Export epochs to Pandas DataFrame &mdash; MNE 0.10.dev0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/navy.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.10.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="MNE 0.10.dev0 documentation" href="../../index.html" />
    <link rel="up" title="Examples" href="../index.html" />
    <link rel="next" title="Interpolate bad channels for MEG/EEG channels" href="../preprocessing/plot_interpolate_bad_channels.html" />
    <link rel="prev" title="Creating MNE objects from data arrays" href="plot_objects_from_arrays.html" />

<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body role="document">

<div style="background-color: red; color: white; font-weight:bold; text-align: center; padding: 10px; min-width: 910px">
This documentation is for the development version (0.10.dev0) - <a href="http://martinos.org/mne/stable">Stable version</a>
</div>

<div style="background-color: white; text-align: left; padding: 10px 7px 15px 15px; min-width: 910px">
<div style="float: left">
<a href="../../index.html"><img src="../../_static/mne_logo.png" border="0" alt="py4sci"/></a>
</div>

<div style="float: right">
<a href="../../index.html"><img src="../../_static/institutions.png" border="0" alt="py4sci"/></a>
</div>
<br style="clear:both"/>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../preprocessing/plot_interpolate_bad_channels.html" title="Interpolate bad channels for MEG/EEG channels"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_objects_from_arrays.html" title="Creating MNE objects from data arrays"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Home</a>&nbsp;|&nbsp;</li>
        <li><a href="../../manual.html">Manual</a>&nbsp;|&nbsp;</li>
        <li><a href="../../mne-python.html">Python</a>&nbsp;|&nbsp;</li>
        <li><a href="../../cite.html">Cite MNE</a>&nbsp;|&nbsp;</li>
        <!-- <li><a href="../../search.html">Search</a></li> -->

          <li class="nav-item nav-item-1"><a href="../../mne-python.html" >MNE with Python</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">Examples</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mne-python.html">MNE with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mne-cpp.html">MNE with CPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cite.html">Cite MNE and MNE-Python</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Versions</h3>
<ul class="current">
    <li class="toctree-l1"><a href=http://martinos.org/mne/stable>Stable</a></li>
    <li class="toctree-l1"><a href=http://martinos.org/mne/dev>Development</a></li>
</ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="export-epochs-to-pandas-dataframe">
<span id="example-io-plot-epochs-to-data-frame-py"></span><h1>Export epochs to Pandas DataFrame<a class="headerlink" href="#export-epochs-to-pandas-dataframe" title="Permalink to this headline">¶</a></h1>
<p>In this example the pandas exporter will be used to produce a DataFrame
object. After exploring some basic features a split-apply-combine
work flow will be conducted to examine the latencies of the response
maxima across epochs and conditions.
Note. Equivalent methods are available for raw and evoked data objects.</p>
<div class="section" id="short-pandas-primer">
<h2>Short Pandas Primer<a class="headerlink" href="#short-pandas-primer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pandas-data-frames">
<h3>Pandas Data Frames<a class="headerlink" href="#pandas-data-frames" title="Permalink to this headline">¶</a></h3>
<p>A data frame can be thought of as a combination of matrix, list and dict:
It knows about linear algebra and element-wise operations but is size mutable
and allows for labeled access to its data. In addition, the pandas data frame
class provides many useful methods for restructuring, reshaping and visualizing
data. As most methods return data frame instances, operations can be chained
with ease; this allows to write efficient one-liners. Technically a DataFrame
can be seen as a high-level container for numpy arrays and hence switching
back and forth between numpy arrays and DataFrames is very easy.
Taken together, these features qualify data frames for inter operation with
databases and for interactive data exploration / analysis.
Additionally, pandas interfaces with the R statistical computing language that
covers a huge amount of statistical functionality.</p>
</div>
<div class="section" id="export-options">
<h3>Export Options<a class="headerlink" href="#export-options" title="Permalink to this headline">¶</a></h3>
<p>The pandas exporter comes with a few options worth being commented.</p>
<p>Pandas DataFrame objects use a so called hierarchical index. This can be
thought of as an array of unique tuples, in our case, representing the higher
dimensional MEG data in a 2D data table. The column names are the channel names
from the epoch object. The channels can be accessed like entries of a
dictionary:</p>
<blockquote>
<div>df[&#8216;MEG 2333&#8217;]</div></blockquote>
<p>Epochs and time slices can be accessed with the .ix method:</p>
<blockquote>
<div>epochs_df.ix[(1, 2), &#8216;MEG 2333&#8217;]</div></blockquote>
<p>However, it is also possible to include this index as regular categorial data
columns which yields a long table format typically used for repeated measure
designs. To take control of this feature, on export, you can specify which
of the three dimensions &#8216;condition&#8217;, &#8216;epoch&#8217; and &#8216;time&#8217; is passed to the Pandas
index using the index parameter. Note that this decision is revertible any
time, as demonstrated below.</p>
<p>Similarly, for convenience, it is possible to scale the times, e.g. from
seconds to milliseconds.</p>
</div>
<div class="section" id="some-instance-methods">
<h3>Some Instance Methods<a class="headerlink" href="#some-instance-methods" title="Permalink to this headline">¶</a></h3>
<p>Most numpy methods and many ufuncs can be found as instance methods, e.g.
mean, median, var, std, mul, , max, argmax etc.
Below an incomplete listing of additional useful data frame instance methods:</p>
<dl class="docutils">
<dt>apply <span class="classifier-delimiter">:</span> <span class="classifier">apply function to data.</span></dt>
<dd>Any kind of custom function can be applied to the data. In combination with
lambda this can be very useful.</dd>
<dt>describe <span class="classifier-delimiter">:</span> <span class="classifier">quickly generate summary stats</span></dt>
<dd>Very useful for exploring data.</dd>
<dt>groupby <span class="classifier-delimiter">:</span> <span class="classifier">generate subgroups and initialize a &#8216;split-apply-combine&#8217; operation.</span></dt>
<dd>Creates a group object. Subsequently, methods like apply, agg, or transform
can be used to manipulate the underlying data separately but
simultaneously. Finally, reset_index can be used to combine the results
back into a data frame.</dd>
<dt>plot <span class="classifier-delimiter">:</span> <span class="classifier">wrapper around plt.plot</span></dt>
<dd>However it comes with some special options. For examples see below.</dd>
<dt>shape <span class="classifier-delimiter">:</span> <span class="classifier">shape attribute</span></dt>
<dd>gets the dimensions of the data frame.</dd>
<dt>values :</dt>
<dd>return underlying numpy array.</dd>
<dt>to_records :</dt>
<dd>export data as numpy record array.</dd>
<dt>to_dict :</dt>
<dd>export data as dict of arrays.</dd>
</dl>
</div>
<div class="section" id="reference">
<h3>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h3>
<p>More information and additional introductory materials can be found at the
pandas doc sites: <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/">http://pandas.pydata.org/pandas-docs/stable/</a></p>
<ul class="horizontal">
<li><a class="first reference internal image-reference" href="../../_images/plot_epochs_to_data_frame_001.png"><img alt="../../_images/plot_epochs_to_data_frame_001.png" src="../../_images/plot_epochs_to_data_frame_001.png" style="width: 376.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/plot_epochs_to_data_frame_002.png"><img alt="../../_images/plot_epochs_to_data_frame_002.png" src="../../_images/plot_epochs_to_data_frame_002.png" style="width: 376.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/plot_epochs_to_data_frame_003.png"><img alt="../../_images/plot_epochs_to_data_frame_003.png" src="../../_images/plot_epochs_to_data_frame_003.png" style="width: 376.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/plot_epochs_to_data_frame_004.png"><img alt="../../_images/plot_epochs_to_data_frame_004.png" src="../../_images/plot_epochs_to_data_frame_004.png" style="width: 376.0px; height: 282.0px;" /></a>
</li>
</ul>
<p><strong>Script output</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>Opening raw data file /data1/agramfort/work/src/mne-python/examples/MNE-sample-data/MEG/sample/sample_audvis_filt-0-40_raw.fif...
    Read a total of 4 projection items:
        PCA-v1 (1 x 102)  idle
        PCA-v2 (1 x 102)  idle
        PCA-v3 (1 x 102)  idle
        Average EEG reference (1 x 60)  idle
Current compensation grade : 0
    Range : 6450 ... 48149 =     42.956 ...   320.665 secs
Ready.
4 projection items activated
10 matching events found
Reading 514 ... 619  =      3.423 ...     4.122 secs...
[done]
Applying baseline correction ... (mode: mean)
    Rejecting  epoch based on EOG : [&#39;EOG 061&#39;]
Reading 606 ... 711  =      4.036 ...     4.735 secs...
[done]
Applying baseline correction ... (mode: mean)
Reading 712 ... 817  =      4.742 ...     5.441 secs...
[done]
...
</pre></div>
</div>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../../_downloads/plot_epochs_to_data_frame.py"><code class="xref download docutils literal"><span class="pre">plot_epochs_to_data_frame.py</span></code></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Author: Denis Engemann &lt;denis.engemann@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mne.io</span> <span class="kn">import</span> <a href="../../generated/mne.io.Raw.html#mne.io.Raw"><span class="n">Raw</span></a>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="kn">import</span> <span class="n">sample</span>

<span class="k">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>

<span class="c"># turn on interactive mode</span>
<a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.ion"><span class="n">plt</span><span class="o">.</span><span class="n">ion</span></a><span class="p">()</span>

<span class="n">data_path</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">data_path</span><span class="p">()</span>
<span class="n">raw_fname</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s">&#39;/MEG/sample/sample_audvis_filt-0-40_raw.fif&#39;</span>
<span class="n">event_fname</span> <span class="o">=</span> <span class="n">data_path</span> <span class="o">+</span> <span class="s">&#39;/MEG/sample/sample_audvis_filt-0-40_raw-eve.fif&#39;</span>

<span class="n">raw</span> <span class="o">=</span> <a href="../../generated/mne.io.Raw.html#mne.io.Raw"><span class="n">Raw</span></a><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>

<span class="c"># For simplicity we will only consider the first 10 epochs</span>
<span class="n">events</span> <span class="o">=</span> <a href="../../generated/mne.read_events.html#mne.read_events"><span class="n">mne</span><span class="o">.</span><span class="n">read_events</span></a><span class="p">(</span><span class="n">event_fname</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

<span class="c"># Add a bad channel</span>
<span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;bads&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;MEG 2443&#39;</span><span class="p">]</span>
<span class="n">picks</span> <span class="o">=</span> <a href="../../generated/mne.pick_types.html#mne.pick_types"><span class="n">mne</span><span class="o">.</span><span class="n">pick_types</span></a><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">meg</span><span class="o">=</span><span class="s">&#39;grad&#39;</span><span class="p">,</span> <span class="n">eeg</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">stim</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="s">&#39;bads&#39;</span><span class="p">)</span>

<span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">reject</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grad</span><span class="o">=</span><span class="mf">4000e-13</span><span class="p">,</span> <span class="n">eog</span><span class="o">=</span><span class="mf">150e-6</span><span class="p">)</span>

<span class="n">event_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">auditory_l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">auditory_r</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">visual_l</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">visual_r</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">epochs</span> <span class="o">=</span> <a href="../../generated/mne.Epochs.html#mne.Epochs"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">event_id</span><span class="p">,</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                    <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="n">reject</span><span class="p">)</span>

<span class="c">###############################################################################</span>
<span class="c"># Export DataFrame</span>

<span class="c"># The following parameters will scale the channels and times plotting</span>
<span class="c"># friendly. The info columns &#39;epoch&#39; and &#39;time&#39; will be used as hierarchical</span>
<span class="c"># index whereas the condition is treated as categorial data. Note that</span>
<span class="c"># this is optional. By passing None you could also print out all nesting</span>
<span class="c"># factors in a long table style commonly used for analyzing repeated measure</span>
<span class="c"># designs.</span>

<span class="n">index</span><span class="p">,</span> <span class="n">scale_time</span><span class="p">,</span> <span class="n">scalings</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;epoch&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">],</span> <span class="mf">1e3</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">grad</span><span class="o">=</span><span class="mf">1e13</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">epochs</span><span class="o">.</span><span class="n">to_data_frame</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scalings</span><span class="o">=</span><span class="n">scalings</span><span class="p">,</span> <span class="n">scale_time</span><span class="o">=</span><span class="n">scale_time</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

<span class="c"># Create MEG channel selector and drop EOG channel.</span>
<span class="n">meg_chs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s">&#39;MEG&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>

<span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;EOG 061&#39;</span><span class="p">)</span>  <span class="c"># this works just like with a list.</span>

<span class="c">###############################################################################</span>
<span class="c"># Explore Pandas MultiIndex</span>

<span class="c"># Pandas is using a MultiIndex or hierarchical index to handle higher</span>
<span class="c"># dimensionality while at the same time representing data in a flat 2d manner.</span>

<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

<span class="c"># Inspecting the index object unveils that &#39;epoch&#39;, &#39;time&#39; are used</span>
<span class="c"># for subsetting data. We can take advantage of that by using the</span>
<span class="c"># .ix attribute, where in this case the first position indexes the MultiIndex</span>
<span class="c"># and the second the columns, that is, channels.</span>

<span class="c"># Plot some channels across the first three epochs</span>
<span class="n">xticks</span><span class="p">,</span> <span class="n">sel</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.arange.html#numpy.arange"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="n">meg_chs</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c"># slice the time starting at t0 in epoch 2 and ending 500ms after</span>
<span class="c"># the base line in epoch 3. Note that the second part of the tuple</span>
<span class="c"># represents time in milliseconds from stimulus onset.</span>
<span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c"># Note: For convenience the index was converted from floating point values</span>
<span class="c"># to integer values. To restore the original values you can e.g. say</span>
<span class="c"># df[&#39;times&#39;] = np.tile(epoch.times, len(epochs_times)</span>

<span class="c"># We now reset the index of the DataFrame to expose some Pandas</span>
<span class="c"># pivoting functionality. To simplify the groupby operation we</span>
<span class="c"># we drop the indices to treat epoch and time as categroial factors.</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c"># The ensuing DataFrame then is split into subsets reflecting a crossing</span>
<span class="c"># between condition and trial number. The idea is that we can broadcast</span>
<span class="c"># operations into each cell simultaneously.</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;condition&#39;</span><span class="p">,</span> <span class="s">&#39;epoch&#39;</span><span class="p">]</span>
<span class="n">sel</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;MEG 1332&#39;</span><span class="p">,</span> <span class="s">&#39;MEG 1342&#39;</span><span class="p">]</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>

<span class="c"># To make the plot labels more readable let&#39;s edit the values of &#39;condition&#39;.</span>
<span class="n">df</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

<span class="c"># Now we compare the mean of two channels response across conditions.</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Mean MEG Response&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;steelblue&#39;</span><span class="p">,</span> <span class="s">&#39;orange&#39;</span><span class="p">])</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c"># We can even accomplish more complicated tasks in a few lines calling</span>
<span class="c"># apply method and passing a function. Assume we wanted to know the time</span>
<span class="c"># slice of the maximum response for each condition.</span>

<span class="n">max_latency</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">sel</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>

<span class="k">print</span><span class="p">(</span><span class="n">max_latency</span><span class="p">)</span>

<span class="c"># Then make the plot labels more readable let&#39;s edit the values of &#39;condition&#39;.</span>
<span class="n">df</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

<a href="http://matplotlib.org/api/figure_api.html#matplotlib.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">()</span>
<span class="n">max_latency</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;barh&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Latency of Maximum Reponse&#39;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;steelblue&#39;</span><span class="p">])</span>
<span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c"># Finally, we will again remove the index to create a proper data table that</span>
<span class="c"># can be used with statistical packages like statsmodels or R.</span>

<span class="n">final_df</span> <span class="o">=</span> <span class="n">max_latency</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">final_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">sel</span><span class="p">[</span><span class="mi">2</span><span class="p">]})</span>  <span class="c"># as the index is oblivious of names.</span>

<span class="c"># The index is now written into regular columns so it can be used as factor.</span>
<span class="k">print</span><span class="p">(</span><span class="n">final_df</span><span class="p">)</span>

<span class="c"># To save as csv file, uncomment the next line.</span>
<span class="c"># final_df.to_csv(&#39;my_epochs.csv&#39;)</span>

<span class="c"># Note. Data Frames can be easily concatenated, e.g., across subjects.</span>
<span class="c"># E.g. say:</span>
<span class="c">#</span>
<span class="c"># import pandas as pd</span>
<span class="c"># group = pd.concat([df_1, df_2])</span>
<span class="c"># group[&#39;subject&#39;] = np.r_[np.ones(len(df_1)), np.ones(len(df_2)) + 1]</span>
</pre></div>
</div>
<p><strong>Total running time of the example:</strong>    1 seconds</p>
<div class="social-button-container">
    <div class="social-button">
        <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    </div>
    <div class="social-button">
        <g:plusone annotation="inline" width="120" size="medium"></g:plusone>
    </div>
    <div class="social-button">
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        </script>
        <div class="fb-like" data-send="false" data-width="450" data-show-faces="false"></div>
    </div>
</div></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012-2015, MNE Developers.
      Last updated on May 22, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4a0+.
    </div>
  </body>
</html>